<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>可视化定制页面</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/bootstrap.css"></link>
    <link rel="stylesheet" href="css/bootstrap-theme.css"></link>
    <style>
        .container{
            width: 100%;
            padding:0;
            margin: auto;
        }
        .collapsed{
            font-size: 16px;

        }
        .panel-body{
            padding: 0;

        }

        a{
            text-decoration: none;
        }
        a:hover{
            text-decoration: none;
        }
        .btn-group{
        padding: 5px 15px;
        }
        .btn-group button{
            padding: 10px 20px;
        }
        a:link{text-decoration:none;}/*点击前*/
        a:visited{text-decoration:none;}/*点击后*/
        a:active{text-decoration:none;}/*点击中*/
    </style>
    <script type="text/javascript">
        mxBasePath = 'src';
    </script>
    <script type="text/javascript" src="src/js/mxClient.js"></script>
</head>

<body onload="main();">

<div class="notice" id="notice" style="display: none">

    <div class="trop" id="trop">x</div>
    <div class="notice_box">
        <div class="box" id="box">
            <div class="inner">
                <!--轮播图-->
                <ul>
                    <li><img src="./editors/images/1.jpg" alt=""></li>
                    <li><img src="./editors/images/2.jpg" alt=""></li>
                    <li><img src="./editors/images/3.jpg" alt=""></li>
                </ul>

                <!-- <ol class="bar">

                </ol> -->
                <!--左右焦点-->
                <div id="arr">
						<span id="left">
							< </span> <span id="right">
								>
						</span>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="container">


    <div class="header">
        <div class="left">
            <em>
                <ol class="breadcrumb">
                    <li><a href="#">首页</a></li>
                    <li><a href="#">工具</a></li>
                    <li class="active">流程图工具栏(Toolbar)</li>
                </ol>
            </em>
        </div>
        <div class="right"></div>
    </div>



    <div class="bottom">

        <div class="mx_left">

            <div class="bar">
                <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-default">全部组件</button>
                    <button type="button" class="btn btn-default">我的流程</button>
                    <button type="button" class="btn btn-default">公开流程</button>
                </div>

            </div>

            <div class="graphBar" id="graphBar">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne" id="item1">

                                </a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse " role="tabpanel" aria-labelledby="headingOne" >
                            <div class="panel-body">
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingTwo">
                            <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" id="item2">

                                </a>
                            </h4>
                        </div>
                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                            <div class="panel-body">
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingThree">
                            <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">

                                </a>
                            </h4>
                        </div>
                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                            <div class="panel-body">
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingFour">
                            <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">

                                </a>
                            </h4>
                        </div>
                        <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                            <div class="panel-body">

                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="common">
                            <h4 class="panel-title">
                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapsecommon" aria-expanded="false" aria-controls="collapsecommon">

                                </a>
                            </h4>
                        </div>
                        <div id="collapsecommon" class="panel-collapse collapse" role="tabpanel" aria-labelledby="common">
                            <div class="panel-body">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="toolBar" style="display: block" >
                <div class="item" id="btn1">
                    <img src="editors/images/fangda.png" alt="">
                </div>
                <div class="item" id="btn2">
                    <img src="editors/images/suoxiao.png" alt="">
                </div>
                <div class="item" id="btn3">
                    <img src="editors/images/huanyuan.png" alt="">
                </div>
                <div class="item" id="btn4">
                    <img src="editors/images/cancel.png" alt="">
                </div>
                <div class="item" id="btn5">
                    <img src="editors/images/qingkong.png" alt="">
                </div>
            </div>
        </div>
        <div class="mx_right">
            <div class="graphArea">流程图绘制区域(Draw area)</div>
            <div class="mxgraph" id="mxgraph"></div>
        </div>
    </div>
</div>
</body>
<script src="js/jquery.min.js"></script>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="js/bootstrap.min.js"></script>
<script src="js/axios-0.18.0.js"></script>
<script>

    // 禁止页面右键复制行为
    document.onselectstart = new Function("event.returnValue=false");

    function main() {
        mxConnectionHandler.prototype.connectImage = new mxImage('images/connector.gif', 16, 16);


        if (!mxClient.isBrowserSupported()) {

            mxUtils.error('Browser is not supported!', 200, false);
        } else {



            //流程图工具栏(Toolbar)
            var tbContainer = document.getElementById('graphBar');


            var toolbar = new mxToolbar(tbContainer);
            toolbar.enabled = false


           var container = document.getElementById('mxgraph');
            container.style.background = 'url("editors/images/grid.gif")';


            if (mxClient.IS_QUIRKS) {
                document.body.style.overflow = 'hidden';
                new mxDivResizer(tbContainer);
                new mxDivResizer(container);
            }


            var model = new mxGraphModel();
            var graph = new mxGraph(container, model);
            graph.dropEnabled = true;

            //禁止在mxgraph图中使用鼠标右键
            mxEvent.disableContextMenu(document.getElementById('mxgraph'));


            //设置这个属性后节点之间才可以连接
            graph.setConnectable(true)

            //开启节点不可改变大小
            graph.setCellsResizable(true)

            //边被拖时，始终保持连接
            graph.setDisconnectOnMove(false)

            //开启tooptip提示
            graph.setTooltips(true)

            // 启用对齐线帮助定位
            mxGraphHandler.prototype.guidesEnabled = true

            //设置节点可连接
            graph.setConnectable(true);
            graph.setTooltips(true);
            graph.setAllowDanglingEdges(false);
            graph.setMultigraph(false);

            mxDragSource.prototype.getDropTarget = function (graph, x, y) {
                var cell = graph.getCellAt(x, y);

                if (!graph.isValidDropTarget(cell)) {
                    cell = null;
                }

                return cell;
            };


            graph.setConnectable(true);
            graph.setMultigraph(false);

            //定义操作栏函数
            document.getElementById('btn1').appendChild(
                mxUtils.button('放大', function () {
                    graph.zoomIn()
                })
            )

            document.getElementById('btn2').appendChild(
                mxUtils.button('缩小', function () {
                    graph.zoomOut()
                })
            )

            document.getElementById('btn3').appendChild(
                mxUtils.button('还原', function () {
                    graph.zoomActual()
                })
            )

            document.getElementById('btn4').appendChild(
                mxUtils.button('删除', function () {
                    var cells = graph.getSelectionCells()
                    graph.removeCells(cells)
                })
            )

            document.getElementById('btn5').appendChild(
                mxUtils.button('清空', function () {
                    graph.removeCells(graph.getChildVertices(graph.getDefaultParent()))
                })
            )


            var keyHandler = new mxKeyHandler(graph);
            var rubberband = new mxRubberband(graph);

            var addVertex = function (icon, w, h, style) {
                var vertex = new mxCell(null, new mxGeometry(0, 0, w, h), style);
                vertex.setVertex(true);

                addToolbarItem(graph, toolbar, vertex, icon);
            };
            //定义全局样式
            //定义节点样式
            var nodeStyle = {};
            nodeStyle[mxConstants.STYLE_FILLCOLOR] = "#3CAEA3";
            nodeStyle[mxConstants.STYLE_FONTSIZE] = 12;
            nodeStyle[mxConstants.STYLE_STROKE_COLOR] = "white";
            nodeStyle[mxConstants.STYLE_FONTCOLOR] = "white";
            nodeStyle[mxConstants.STYLE_ROUNDED] = 1;
            var data = [];

            axios.get("http://localhost/algcmpt").then(res => {
                console.log(res)
                data = res.data.data;
                console.log(data)
                console.log(data.length)

                var data1 = []
                var data3 = []
                var data4 = []
                var data5 = []
                var q= 0
                var w= 0
                var e= 0
                var r= 0
                //分组
                for (let j = 0; j < data.length; j++) {
                    // for (let i = 0; i < 5; i++) {
                    //
                    // }
                    console.log(data[j].algorithmle)
                    if (data[j].algorithmle == 1) {
                        data1[q] = data[j];
                        q++
                    } else if (data[j].algorithmle == 3) {
                        data3[w] = data[j];
                        w++
                    } else if (data[j].algorithmle == 4) {
                        data4[e] = data[j];
                        e++
                    } else if (data[j].algorithmle == 5) {
                        data5[r] = data[j];
                        r++
                    }
                }
                //设置图形分类
                $(".collapsed")[4].text="公共组件"
                $(".collapsed")[0].text=data1[0].algorithmcl;
                $(".collapsed")[1].text=data3[0].algorithmcl;
                $(".collapsed")[2].text=data4[0].algorithmcl;
                $(".collapsed")[3].text=data5[0].algorithmcl;


                // $(".panel-body")[1].text=data3[0].algorithmcl;
                // $(".panel-body")[2].text=data4[0].algorithmcl;
                // $(".panel-body")[3].text=data5[0].algorithmcl;


                //
                // console.log(data1)
                //
                // console.log(data4)
                // console.log(data5)

                for (let i = 0; i < data1.length; i++) {
                    addVertex('editors/images/tuoyuanxing.png', 100, 50, 'nodeStyle');
                    $(".panel-body")[0].after($(".mxToolbarMode")[0])
                    $(".panel-body")[0].after(data1[i].algorithmde)

                }
                for (let i = 0; i < data3.length; i++) {
                    console.log(data3)
                    addVertex('editors/images/juxing.png', 80, 80, 'shape=rectangle;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12')
                    $(".panel-body")[1].after($(".mxToolbarMode")[data1.length+i])
                    $(".panel-body")[1].after(data3[i].algorithmde)

                }
                for (let i = 0; i < data4.length; i++) {
                    addVertex('editors/images/tubiao.png', 70, 50, 'shape=rhombus;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12');
                    $(".panel-body")[2].after(data4[i].algorithmde)
                    $(".panel-body")[2].after($(".mxToolbarMode")[data1.length+i+data3.length])
                }
                for (let i = 0; i < data5.length; i++) {
                    addVertex('editors/images/xingzhuang-sanjiaoxing.png', 100, 50, 'shape=hexagon;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;');
                    $(".panel-body")[3].after(data5[i].algorithmde)
                    $(".panel-body")[3].after($(".mxToolbarMode")[data1.length+i+data3.length+data4.length])
                }
                // //线段
                addVertex('editors/images/line.png', 40, 60, 'shape=line;');



                addVertex('editors/images/juxing.png', 100, 40,
                    'shape=rectangle;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;'
                );

                //椭圆
                addVertex('editors/images/tuoyuanxing.png', 100, 40,
                    'shape=ellipse;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;'
                );

                //菱形
                addVertex('editors/images/tubiao.png', 100, 40,
                    'shape=rhombus;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;'
                );

                //箭头
                addVertex('editors/images/xingzhuang-sanjiaoxing.png', 100, 40,
                    'shape=triangle;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;'
                );

                //六边形
                addVertex('editors/images/tx-liubianxing.png', 100, 40,
                    'shape=hexagon;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;'
                );

                //actor
                addVertex('editors/images/ren-.png', 40, 60,
                    'shape=actor;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;');

                //云
                addVertex('editors/images/cloud.png', 100, 40,
                    'shape=cloud;fillColor=#3CAEA3;strokeColor=white;fontStyle=1;fontColor=white;rounded=1;fontSize=12;');

            })
            // console.log(333)
            //三角形


            // 				rectangle  ellipse doubleEllipse  rhombus line image arrow
            // arrowConnector label cylinder swimlane connector actor triangle hexagon

        }
    }

    function addToolbarItem(graph, toolbar, prototype, image) {
        var funct = function (graph, evt, cell) {
            graph.stopEditing(false);

            var pt = graph.getPointForEvent(evt);
            var vertex = graph.getModel().cloneCell(prototype);
            vertex.geometry.x = pt.x;
            vertex.geometry.y = pt.y;

            graph.setSelectionCells(graph.importCells([vertex], 0, 0, cell));
        }

        var img = toolbar.addMode(null, image, funct);
        mxUtils.makeDraggable(img, graph, funct);
    }



</script>
<script>
    document.getElementById('trop').onclick = function () {
        document.getElementById('notice').style.display = 'none'
    }
</script>
<script src="js/lunbotu.js"></script>

</html>